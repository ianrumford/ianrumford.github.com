<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">

<meta property="og:title" content="Writing Apache Pig UDFs in JRuby">
<title>Writing Apache Pig UDFs in JRuby</title>
<meta property="og:description" content="Apache Pig is part of theHadoop MapReduce ecosystem.Pig describes itself as:  “a platform for analyzing large data sets that consists of ahigh-level language...">
<meta property="og:url" content="http://www.rumford.name/apache/pig/ruby/jruby/udf/2012/09/17/writing-apache-pig-udfs-in-jruby.html">
<meta property="og:site_name" content="An Ostler in IT">
<meta property="og:locale" content="en_UK">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ianrumford">
<meta name="twitter:creator" content="@ianrumford">
<meta name="twitter:title" content="Writing Apache Pig UDFs in JRuby">
<meta name="twitter:description" content="Apache Pig is part of theHadoop MapReduce ecosystem.Pig describes itself as:  “a platform for analyzing large data sets that consists of ahigh-level language...">
<meta name="twitter:url" content="http://www.rumford.name/apache/pig/ruby/jruby/udf/2012/09/17/writing-apache-pig-udfs-in-jruby.html">

<meta name="keywords" content="IT Ostler Horses Courses">

<link rel="icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://www.rumford.name/apache/pig/ruby/jruby/udf/2012/09/17/writing-apache-pig-udfs-in-jruby.html">
<link rel="alternate" type="application/atom+xml" title="An Ostler in IT" href="http://www.rumford.name/feed.xml" />

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script language="Javascript" type="text/javascript">
function search_google()
{
  var query = document.getElementById("google-search").value;
  window.open("http://google.com/search?q=" + query
      + "%20site:" + "http://www.rumford.name");
}
</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>


<script type='text/javascript'>
var blocklink = ['http://humanorightswatch.org','http://o-o-6-o-o.com','http://darodar.com','http://blackhatworth.com','http://hulfingtonpost.com','http://bestwebsitesawards.com','http://darodar.com','http://buttons-for-website.com','http://ilovevitaly.co','http://semalt.com','http://priceg.com','http://simple-share-buttons.com','http://googlsucks.com','http://4webmasters.org','http://aliexpress.com','http://addons.mozilla.org/en-US/firefox/addon/ilovevitaly/','http://free-share-buttons.com','http://buttons-for-your-website.com','http://theguardlan.com','http://buy-cheap-online.info','http://best-seo-offer.com','http://4webmasters.org','http://trafficmonetize.org','http://howtostopreferralspam.eu','http://ilovevitaly.com','http://sanjosestartups.com','http://free-social-buttons.com','http://best-seo-offer.com','http://guardlink.org','http://www.event-tracking.com','http://www3.free-social-buttons.com','http://www1.free-social-buttons.com','http://www2.free-social-buttons.com','http://websites-reviews.com','http://floating-share-buttons.com','http://satellite.maps.ilovevitaly.com','http://free-social-buttons.com','http://www.event-tracking.com','http://erot.co'];
for (var b = blocklink.length; b--;) {
  if (document.referrer.match(blocklink[b]))
    window.location = "http://www.google.com";
}
</script>



<link type="application/atom+xml" rel="alternate" href="http://www.rumford.name/atom.xml" title="An Ostler in IT" />
</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">An Ostler in IT</a></h1>
    <h3 class="site-meta">Horses for Courses</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">Home</a>
        
        
        
        <a class="page-link" href="/about/">About</a>
        
        
        
        <a class="page-link" href="/archives/">Archives</a>
        
        
        
        <a class="page-link" href="/categories/">Categories</a>
        
        
        
        <a class="page-link" href="/tags/">Tags</a>
        
        
        
        <a class="page-link" href="/guestbook/"></a>
        
        
        
        <a class="page-link" href="/feed.xml"></a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name" class="post-title">Writing Apache Pig UDFs in JRuby</h1>
    <meta itemprop="keywords" content="" />
    <p class="post-meta">
    Posted in
    
    <a href="/categories/#apache">apache</a>, 
    
    <a href="/categories/#pig">pig</a>, 
    
    <a href="/categories/#ruby">ruby</a>, 
    
    <a href="/categories/#jruby">jruby</a>, 
    
    <a href="/categories/#udf">udf</a>
     
    
    <time itemprop="datePublished" datetime="2012-09-17">
    on Sep 17, 2012
    </time>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <p>Apache <a href="http://pig.apache.org/">Pig</a> is part of the
<a href="http://hadoop.apache.org/">Hadoop</a> MapReduce ecosystem.</p>

<p>Pig describes itself as:</p>

<blockquote>
  <p>“a platform for analyzing large data sets that consists of a
high-level language for expressing data analysis programs, coupled with infrastructure for evaluating these programs. The salient property of Pig programs is that their structure is amenable to substantial parallelization, which in turns enables them to handle very large data sets.”</p>
</blockquote>

<p>Pig pre-empts  the need to write lower-level MapReduce jobs to process
large datasets.  It has its own “high level language” for data
manipulation and relationships called
<a href="http://pig.apache.org/docs/r0.10.0/basic.html">Pig Latin</a>.  Pig Latin
is really an external domain specific language (<em>DSL</em>) written in Java.</p>

<p>Pig is a very good tool for extract-transform-and-load (<em>etl</em>) ‘duct
tape’ tasks e.g.
taking data from text-base log files, parsing the records and loading
the extracted fields
into e.g a HBase table.</p>

<p>But Pig Latin is both a strength and weakness.  A strength because, once
the basics have been learnt, useful stuff can be done pretty quickly.
A weakness because its another thing to learn and quite orthogonal to
anything else in the Hadoop world.  Although written in Java, a Pig
Latin script can’t contain Java directly.</p>

<p>Contrast this with
<a href="https://github.com/nathanmarz/cascalog/wiki">Cascalog</a> - a competitor
to Pig - that provides its own data manipulation and relationship DSL but in a <a href="http://clojure.org/">Clojure</a>
environment - Cascalog programs can directly define and use Clojure
functions and use all the facilities of the Clojure language
to do their work.</p>

<p>Recognising a limitation, the authors of Pig support the creation of
<a href="http://pig.apache.org/docs/r0.10.0/udf.html">user defined functions</a>
(<em>UDFs</em>).  The pretty good documentation for UDFs shows how to create
them in Java, Python, JavaScript and, with the
<a href="http://pig.apache.org/releases.html">latest</a> release (0.10.0) of
 of Pig, <a href="http://jruby.org/">JRuby</a>.</p>

<p>Writing JRuby UDFs is very straightforward and easy once the <em>recipe</em>
has been learnt.  The authors of the JRuby
support have done a very good job at minimising the <em>impedance mismatch</em>.
(The chronology in this <a href="https://issues.apache.org/jira/browse/PIG-2317">link</a>
demonstrates how the shape of the final support was
arrived at by smart,
mutually respectful and talented people. An example, IMHO, of the best in
open source.)</p>

<p>BTW I was lead to looking at JRuby UDFs by this very good <a href="http://hortonworks.com/blog/pig-as-hadoop-connector-part-two-hbase-jruby-and-sinatra/">post</a> by 
Russell Jurney.</p>

<p>In the rest of the post, I explore the creation of a JRuby UDF to
<em>etl</em> a log file into HBase.  In my example, the log file was from a
Ubuntu audit subsystem log (<em>auditd</em>).</p>

<!-- more -->

<h1 id="install-hbase">Install HBase</h1>

<p>The latest version of HBase (0.94.1) will be used.</p>

<p>A simple recipe for HBase was given in Russell’s post, here’s my minor
variant:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="nb">cd</span> /tmp
wget http://archive.apache.org/dist/hbase/hbase-0.94.1/hbase-0.94.1.tar.gz
tar -xvf hbase-0.94.1.tar.gz
mv hbase-0.94.1.tar.gz /usr/lib/hbase
chown -R root.root /usr/lib/hbase
mkdir /var/hbase<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The file /usr/lib/hbase/conf/hbase-site.xml should be like this:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>hbase.rootdir<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;value&gt;</span>file:///var/hbase<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>And start HBase:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>/usr/lib/hbase/bin/start-hbase.sh<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="install-pig">Install Pig</h1>

<p>The Pig download and install is similar to HBase:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nb">cd</span> /tmp
wget http://mirror.ox.ac.uk/sites/rsync.apache.org/pig/pig-0.10.0/pig-0.10.0.tar.gz
tar -xvf pig-0.10.0.tar.gz
mv pig-0.10.0 /usr/lib/pig
chown -R root.root /usr/lib/pig<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="creating-the-hbase-table-and-column-family">Creating the HBase table and column family</h1>

<p>The easiest way to create the table (e.g. <em>blog_udf1</em>) and column
family (e.g. <em>record</em>) is  using the
HBase shell (which is itself a JRuby program).</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>/usr/lib/hbase/bin/hbase shell

HBase Shell; enter <span class="s1">'help&lt;RETURN&gt;'</span> <span class="k">for </span>list of supported commands.
Type <span class="s2">"exit&lt;RETURN&gt;"</span> to leave the HBase Shell
Version 0.94.1, r1365210, Tue Jul 24 18:40:10 UTC 2012

<span class="gp">hbase(main):001:0&gt; </span>create <span class="s1">'blog_udf1'</span>, <span class="s1">'record'</span>
0 row<span class="o">(</span>s<span class="o">)</span> <span class="k">in </span>0.5590 seconds

<span class="gp">hbase(main):002:0&gt; </span>quit<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="executing-a-pig-latin-script">Executing a Pig Latin script</h1>

<p>To run a Pig Latin script, the Java classpath needs to be set:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nb">export </span><span class="nv">PIG_CLASSPATH</span><span class="o">=</span>/usr/lib/hbase/<span class="k">*</span>:/usr/lib/hbase/lib/<span class="k">*</span>:/usr/lib/pig/<span class="k">*</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The examples below execute Pig in <em>local mode</em> i.e. run the job on the
local machine (c.f. a Hadoop cluster).  For example, where
<em>blog_udf1.pig</em> is the  Pig Latin script in my <em>bin</em> directory:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>/usr/lib/pig/bin/pig -x <span class="nb">local</span> ../bin/blog_udf1.pig<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="some-example-auditd-log-records">Some example auditd log records</h1>

<p>The auditd log is fairly regularly formatted.  Most lines have a
<em>prefix</em>, delimited with a colon (:), including the <em>type</em> field,
followed by type-specific data.  Note the <em>node</em> is the host name.</p>

<p>NOTE:  this data has been selected for demonstration purposes; not all
records fit into this regular pattern (but most do).</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>DAEMON_START <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114506.467:9723<span class="o">)</span>: auditd start, <span class="nv">ver</span><span class="o">=</span>1.7.18 <span class="nv">format</span><span class="o">=</span>raw <span class="nv">kernel</span><span class="o">=</span>3.2.0-26-generic <span class="nv">auid</span><span class="o">=</span>4294967295 <span class="nv">pid</span><span class="o">=</span>1054 <span class="nv">subj</span><span class="o">=</span>unconfined  <span class="nv">res</span><span class="o">=</span>success
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>CONFIG_CHANGE <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114506.571:24<span class="o">)</span>: <span class="nv">audit_backlog_limit</span><span class="o">=</span>8192 <span class="nv">old</span><span class="o">=</span>64 <span class="nv">auid</span><span class="o">=</span>4294967295 <span class="nv">ses</span><span class="o">=</span>4294967295 <span class="nv">res</span><span class="o">=</span>1
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>CONFIG_CHANGE <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114506.571:25<span class="o">)</span>: <span class="nv">audit_failure</span><span class="o">=</span>2 <span class="nv">old</span><span class="o">=</span>1 <span class="nv">auid</span><span class="o">=</span>4294967295 <span class="nv">ses</span><span class="o">=</span>4294967295 <span class="nv">res</span><span class="o">=</span>1
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>CONFIG_CHANGE <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114506.579:105<span class="o">)</span>: <span class="nv">audit_enabled</span><span class="o">=</span>1 <span class="nv">old</span><span class="o">=</span>1 <span class="nv">auid</span><span class="o">=</span>4294967295 <span class="nv">ses</span><span class="o">=</span>4294967295 <span class="nv">res</span><span class="o">=</span>1
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>LOGIN <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114506.751:106<span class="o">)</span>: login <span class="nv">pid</span><span class="o">=</span>1104 <span class="nv">uid</span><span class="o">=</span>0 old <span class="nv">auid</span><span class="o">=</span>4294967295 new <span class="nv">auid</span><span class="o">=</span>104 old <span class="nv">ses</span><span class="o">=</span>4294967295 new <span class="nv">ses</span><span class="o">=</span>1
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>LOGIN <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114517.503:107<span class="o">)</span>: login <span class="nv">pid</span><span class="o">=</span>1447 <span class="nv">uid</span><span class="o">=</span>0 old <span class="nv">auid</span><span class="o">=</span>4294967295 new <span class="nv">auid</span><span class="o">=</span>1000 old <span class="nv">ses</span><span class="o">=</span>4294967295 new <span class="nv">ses</span><span class="o">=</span>2
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>SYSCALL <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114517.511:108<span class="o">)</span>: <span class="nv">arch</span><span class="o">=</span>c000003e <span class="nv">syscall</span><span class="o">=</span>87 <span class="nv">success</span><span class="o">=</span>no <span class="nb">exit</span><span class="o">=</span>-2 <span class="nv">a0</span><span class="o">=</span>e273d0 <span class="nv">a1</span><span class="o">=</span>0 <span class="nv">a2</span><span class="o">=</span>e22620 <span class="nv">a3</span><span class="o">=</span>7ffffcd967e0 <span class="nv">items</span><span class="o">=</span>1 <span class="nv">ppid</span><span class="o">=</span>1447 <span class="nv">pid</span><span class="o">=</span>1539 <span class="nv">auid</span><span class="o">=</span>1000 <span class="nv">uid</span><span class="o">=</span>1000 <span class="nv">gid</span><span class="o">=</span>1000 <span class="nv">euid</span><span class="o">=</span>1000 <span class="nv">suid</span><span class="o">=</span>1000 <span class="nv">fsuid</span><span class="o">=</span>1000 <span class="nv">egid</span><span class="o">=</span>1000 <span class="nv">sgid</span><span class="o">=</span>1000 <span class="nv">fsgid</span><span class="o">=</span>1000 <span class="nv">tty</span><span class="o">=(</span>none<span class="o">)</span> <span class="nv">ses</span><span class="o">=</span>2 <span class="nv">comm</span><span class="o">=</span><span class="s2">"gnome-keyring-d"</span> <span class="nv">exe</span><span class="o">=</span><span class="s2">"/usr/bin/gnome-keyring-daemon"</span> <span class="nv">key</span><span class="o">=</span><span class="s2">"delete"</span>
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>CWD <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114517.511:108<span class="o">)</span>:  <span class="nv">cwd</span><span class="o">=</span><span class="s2">"/"</span>
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>PATH <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114517.511:108<span class="o">)</span>: <span class="nv">item</span><span class="o">=</span>0 <span class="nv">name</span><span class="o">=</span><span class="s2">"/tmp/keyring-GZxINJ/control"</span> <span class="nv">inode</span><span class="o">=</span>1574066 <span class="nv">dev</span><span class="o">=</span>08:01 <span class="nv">mode</span><span class="o">=</span>040700 <span class="nv">ouid</span><span class="o">=</span>1000 <span class="nv">ogid</span><span class="o">=</span>1000 <span class="nv">rdev</span><span class="o">=</span>00:00
<span class="nv">node</span><span class="o">=</span>cdh4flumevm1 <span class="nb">type</span><span class="o">=</span>SYSCALL <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1342114517.547:109<span class="o">)</span>: <span class="nv">arch</span><span class="o">=</span>c000003e <span class="nv">syscall</span><span class="o">=</span>93 <span class="nv">success</span><span class="o">=</span>yes <span class="nb">exit</span><span class="o">=</span>0 <span class="nv">a0</span><span class="o">=</span>9 <span class="nv">a1</span><span class="o">=</span>3e8 <span class="nv">a2</span><span class="o">=</span>3e8 <span class="nv">a3</span><span class="o">=</span>7fff7d9907c0 <span class="nv">items</span><span class="o">=</span>1 <span class="nv">ppid</span><span class="o">=</span>987 <span class="nv">pid</span><span class="o">=</span>1447 <span class="nv">auid</span><span class="o">=</span>1000 <span class="nv">uid</span><span class="o">=</span>1000 <span class="nv">gid</span><span class="o">=</span>1000 <span class="nv">euid</span><span class="o">=</span>1000 <span class="nv">suid</span><span class="o">=</span>0 <span class="nv">fsuid</span><span class="o">=</span>1000 <span class="nv">egid</span><span class="o">=</span>1000 <span class="nv">sgid</span><span class="o">=</span>0 <span class="nv">fsgid</span><span class="o">=</span>1000 <span class="nv">tty</span><span class="o">=(</span>none<span class="o">)</span> <span class="nv">ses</span><span class="o">=</span>2 <span class="nv">comm</span><span class="o">=</span><span class="s2">"lightdm"</span> <span class="nv">exe</span><span class="o">=</span><span class="s2">"/usr/sbin/lightdm"</span> <span class="nv">key</span><span class="o">=</span><span class="s2">"perm_mod"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The log is stored in <em>./data/blog_audit1.log</em> in the Pig Latin scripts below.</p>

<h1 id="using-a-jruby-udf-returning-scalars-to-etl-audit-data">Using a JRuby UDF returning scalars to etl audit data</h1>

<h2 id="the-scalar-jruby-udf">The Scalar JRuby UDF</h2>

<p>Russell’s post, linked above, shows a very simple example of using JRuby
to generate a <em>uuid</em>, returning it (as a string / chararray).</p>

<p>The below builds on that example to return both a uuid, to be used as
the HBase <em>rowkey</em>, and the <em>type</em>
of the parsed auditd log entry.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'pigudf'</span>

<span class="nb">require</span> <span class="s1">'java'</span>  <span class="c1"># Magic line for JRuby - Java interworking</span>
 
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="nf">util</span><span class="o">.</span><span class="no">UUID</span>
 
<span class="k">class</span> <span class="nc">JRubyUdf</span> <span class="o">&lt;</span> <span class="no">PigUdf</span>
  
  <span class="n">outputSchema</span> <span class="s2">"uuid:chararray"</span>
  <span class="k">def</span> <span class="nf">uuid</span><span class="p">()</span>
    <span class="n">java</span><span class="p">.</span><span class="nf">util</span><span class="o">.</span><span class="no">UUID</span><span class="p">.</span><span class="nf">randomUUID</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
  <span class="k">end</span>
  
  <span class="n">outputSchema</span> <span class="s2">"type:chararray"</span>
  <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="n">auditRecord</span><span class="p">)</span>
    
    <span class="p">(</span><span class="n">recordPrefix</span><span class="p">,</span> <span class="n">recordData</span><span class="p">)</span> <span class="o">=</span> <span class="n">auditRecord</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span>

    <span class="c1"># Generate a hash of all the prefix fields:  node, type and msg</span>
    <span class="n">prefixFields</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">[</span><span class="o">*</span><span class="n">recordPrefix</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span><span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)}.</span><span class="nf">flatten</span><span class="p">]</span>

    <span class="n">prefixFields</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="c1"># return the type</span>

  <span class="k">end</span>
  
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Notes:</p>

<ul>
  <li>
    <p>the <em>require “pigudf”</em> provide the link with the Pig world and
facilitate easy Pig-to-JRuby communication and interworking.</p>
  </li>
  <li>
    <p>the JRuby class must  subclass of <em>PigUdf</em></p>
  </li>
  <li>
    <p>the class name <em>seems</em> to be arbitrary - the Pig Latin script
defines the mnemonic used to refer to the class.</p>
  </li>
  <li>
    <p>the <em>outputSchema</em> defines the <em>data type</em> of the return value from the
method named (i.e. a chararray / string for both <em>uuid</em> and <em>type</em>)</p>
  </li>
</ul>

<h2 id="the-scalar-pig-latin-script">The Scalar Pig Latin script</h2>

<p>The Pig Latin script (e.g. <em>./bin/blog_udf1.pig</em>) is minimal:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre><span class="cm">/* Load auditd data into Hbase using a JRuby UDF for processing */</span>

<span class="cm">/* The UDF returns Scalars (chararays / strings)

/* Register the JRuby UDf with Pig */</span>

<span class="n">register</span> <span class="err">'</span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">blog_udf1</span><span class="o">.</span><span class="na">rb</span><span class="err">'</span> <span class="n">using</span> <span class="n">jruby</span> <span class="n">as</span> <span class="n">blog_udf1</span><span class="o">;</span>

<span class="n">auditd_records</span> <span class="o">=</span> <span class="n">load</span> <span class="err">'</span><span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">blog_audit1</span><span class="o">.</span><span class="na">log</span><span class="err">'</span> <span class="n">using</span> <span class="nf">PigStorage</span><span class="o">()</span>
                      <span class="n">as</span> <span class="o">(</span><span class="nl">record:</span><span class="n">chararray</span><span class="o">);</span>

<span class="cm">/*

Generate a collection of tuples with two fields: an id (a uuid) and
the type from the auditd record

*/</span>

<span class="n">auditd_types</span> <span class="o">=</span> <span class="n">foreach</span> <span class="n">auditd_records</span> <span class="n">generate</span> <span class="n">blog_udf1</span><span class="o">.</span><span class="na">uuid</span><span class="o">()</span> <span class="n">as</span> <span class="n">id</span><span class="o">,</span> 
                       <span class="n">blog_udf1</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">record</span><span class="o">)</span> <span class="n">as</span> <span class="n">type</span><span class="o">;</span>


<span class="cm">/* 

Store to the HBase table 'blog_udf1', column family 'record' using the uuid
as the row key by specifying  the loadKey option. 

*/</span>

<span class="n">store</span> <span class="n">auditd_types</span> <span class="n">into</span> <span class="err">'</span><span class="nl">hbase:</span><span class="c1">//blog_udf1' using</span>
     <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">pig</span><span class="o">.</span><span class="na">backend</span><span class="o">.</span><span class="na">hadoop</span><span class="o">.</span><span class="na">hbase</span><span class="o">.</span><span class="na">HBaseStorage</span><span class="o">(</span><span class="err">'</span><span class="nl">record:</span><span class="n">type</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">loadKey</span> <span class="kc">true</span><span class="err">'</span><span class="o">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="using-a-jruby-udf-returning-a-hash--map-to-etl-audit-data">Using a JRuby UDF returning a hash / map to etl audit data</h1>

<h2 id="the-hash--map-jruby-udf">The Hash / Map JRuby UDF</h2>

<p>So far, so good.  But a more natural way to return a collection of
fields and their values would be in a hash.</p>

<p>The example above has been reworked below to return all of the prefix fields
(<em>type</em>, <em>node</em>, <em>msg</em>) from the audit record, 
as well as an <em>id</em> key with a value generated by the <em>uuid</em> method.</p>

<p>Also, two new fields has been added (<em>unique</em> and <em>passed</em>) to
demonstrate returning integer and boolean values.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'pigudf'</span>

<span class="nb">require</span> <span class="s1">'java'</span>  <span class="c1"># Magic line for JRuby - Java interworking</span>
 
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="nf">util</span><span class="o">.</span><span class="no">UUID</span>
 
<span class="k">class</span> <span class="nc">JRubyUdf</span> <span class="o">&lt;</span> <span class="no">PigUdf</span>

  <span class="n">outputSchema</span> <span class="s2">"parse:map"</span>
  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">auditRecord</span><span class="p">)</span>
    
    <span class="p">(</span><span class="n">recordPrefix</span><span class="p">,</span> <span class="n">recordData</span><span class="p">)</span> <span class="o">=</span> <span class="n">auditRecord</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span>

    <span class="c1"># Generate a hash of all the prefix fields:  node, type and msg</span>
    <span class="n">prefixFields</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">[</span><span class="o">*</span><span class="n">recordPrefix</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span><span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)}.</span><span class="nf">flatten</span><span class="p">]</span>

    <span class="n">prefixFields</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">uuid</span> <span class="c1"># add the id with a uuid</span>

    <span class="n">prefixFields</span><span class="p">[</span><span class="s1">'unique'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span> <span class="c1"># Add an *integer*</span>
    <span class="n">prefixFields</span><span class="p">[</span><span class="s1">'passed'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'true'</span>  <span class="c1"># Add a boolean BUT as a string</span>
    
    <span class="n">prefixFields</span> <span class="c1"># return the hash; it will become a Pig Map</span>

  <span class="k">end</span>
  
  <span class="kp">private</span>
  
  <span class="k">def</span> <span class="nf">uuid</span><span class="p">()</span>
    <span class="n">java</span><span class="p">.</span><span class="nf">util</span><span class="o">.</span><span class="no">UUID</span><span class="p">.</span><span class="nf">randomUUID</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
  <span class="k">end</span>
  
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Notes:</p>

<ul>
  <li>
    <p>the outputSchema for the <em>parse</em> method is <em>map</em></p>
  </li>
  <li>
    <p>the <em>parse</em> method returns a regular JRuby hash</p>
  </li>
</ul>

<h2 id="the-hash--map-pig-latin-script">The Hash / Map Pig Latin script</h2>

<p>The Pig Latin script is more complicated as it has to accept the JRuby
Hash, extract and cast the wanted keys’ values and store all of them in
the HBase table (remember to create it using the HBase shell: create ‘blog_udf2’, ‘record’):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></td><td class="code"><pre><span class="cm">/* Load auditd data into Hbase using a JRuby UDF for processing */</span>

<span class="cm">/* The UDF returns a Map / Hash */</span>

<span class="cm">/* Register the JRuby UDf with Pig */</span>

<span class="n">register</span> <span class="err">'</span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">blog_udf2</span><span class="o">.</span><span class="na">rb</span><span class="err">'</span> <span class="n">using</span> <span class="n">jruby</span> <span class="n">as</span> <span class="n">blog_udf2</span><span class="o">;</span>

<span class="n">auditd_records</span> <span class="o">=</span> <span class="n">load</span> <span class="err">'</span><span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">blog_audit1</span><span class="o">.</span><span class="na">log</span><span class="err">'</span> <span class="n">using</span> <span class="nf">PigStorage</span><span class="o">()</span>
                      <span class="n">as</span> <span class="o">(</span><span class="nl">record:</span><span class="n">chararray</span><span class="o">);</span>

<span class="cm">/*

Generate a collection of tuples with the fields from the returned hash

Note the fields' values have to be cast appropriately 

*/</span>

<span class="n">auditd_fields</span> <span class="o">=</span> <span class="n">foreach</span> <span class="n">auditd_records</span> <span class="o">{</span>
     <span class="n">hash</span> <span class="o">=</span> <span class="n">blog_udf2</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">record</span><span class="o">);</span>
     <span class="n">generate</span> <span class="o">(</span><span class="n">chararray</span><span class="o">)</span> <span class="n">hash</span><span class="err">#'</span><span class="n">id</span><span class="err">'</span><span class="o">,</span> <span class="o">(</span><span class="n">chararray</span><span class="o">)</span> <span class="n">hash</span><span class="err">#'</span><span class="n">type</span><span class="err">'</span><span class="o">,</span> <span class="o">(</span><span class="n">chararray</span><span class="o">)</span> <span class="n">hash</span><span class="err">#'</span><span class="n">node</span><span class="err">'</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">hash</span><span class="err">#'</span><span class="n">unique</span><span class="err">'</span><span class="o">,</span> <span class="o">(</span><span class="kt">boolean</span><span class="o">)</span> <span class="n">hash</span><span class="err">#'</span><span class="n">passed</span><span class="err">'</span><span class="o">;</span>
     <span class="o">};</span>

<span class="cm">/*

The describe should display:

auditd_fields: {chararray,chararray,chararray,int,boolean}

*/</span>

<span class="n">describe</span> <span class="n">auditd_fields</span><span class="o">;</span>

<span class="cm">/* 

Store to the HBase table 'blog_udf2', column family 'record' using the uuid
as the row key by specifying  the loadKey option. 

*/</span>

<span class="n">store</span> <span class="n">auditd_fields</span> <span class="n">into</span> <span class="err">'</span><span class="nl">hbase:</span><span class="c1">//blog_udf2' using</span>
     <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">pig</span><span class="o">.</span><span class="na">backend</span><span class="o">.</span><span class="na">hadoop</span><span class="o">.</span><span class="na">hbase</span><span class="o">.</span><span class="na">HBaseStorage</span><span class="o">(</span><span class="err">'</span><span class="nl">record:</span><span class="n">type</span> <span class="nl">record:</span><span class="n">node</span> <span class="nl">record:</span><span class="n">unique</span> <span class="nl">record:</span><span class="n">passed</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">loadKey</span> <span class="kc">true</span><span class="err">'</span><span class="o">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Notes:</p>

<ul>
  <li>
    <p>although the returned hash has a <em>msg</em> key-value pair, it is ignored (discarded)
in the <em>generate</em></p>
  </li>
  <li>
    <p>The string values in the hash have to be cast to <em>chararray</em> on the
generate</p>
  </li>
  <li>
    <p>the integer (fixnum) values in the hash have to be cast to <em>int</em>
  or <em>long</em> on the generate (although they will become byte arrays
  in HBase)</p>
  </li>
  <li>
    <p>a boolean value must be passed back as a string, either
<em>true</em> or <em>false</em>, and cast to <em>boolean</em> on the generate (but again
will be stored as a byte array by HBase)</p>
  </li>
  <li>
    <p>the <em>describe</em> command displays the types of the various fields in
the new tuple e.g
chararray, int and boolean</p>
  </li>
  <li>
    <p>the store into HBase now includes the other fields as well as the <em>type</em></p>
  </li>
</ul>

<h1 id="final-words">Final Words</h1>

<p>Being able to write Pig UDFs in JRuby (and I guess Python) makes Pig a
very nice solution for data manipulation, especially in an <em>etl</em> pipeline.</p>

<p>I’m  intrigued how easy it would be to write a UDF in Clojure, where
the impedance mismatch between Pig and the UDF should
be minimal as well, and performance close to a native Java UDF.  That will be another post.</p>


  </article>
  <hr />
</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/2012/09/15/a-service-oriented-administrative-architecture.html" title="A service-oriented administrative architecture">&larr; Older</a></li>
    
    
    <li class="next"><a href="/clojure/apache/pig/udf/2012/09/21/writing-apache-pig-udfs-in-clojure.html" title="Writing Apache Pig UDFs in Clojure">Newer &rarr;</a></li>
    
  </ul>
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://www.rumford.name/2012/09/15/a-service-oriented-administrative-architecture.html';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://www.rumford.name/clojure/apache/pig/udf/2012/09/21/writing-apache-pig-udfs-in-clojure.html';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



    <section class="pager">
  
  
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h4>About Me</h4>
  <img title="Whistlejacket" src="/images/whistlejacket-circle-128px-2.png" alt="Whistlejacket"/>
  <span>Ian Rumford's whisperings</span>
  <br />

  

  You can contact me via: <br />

  
  <a href="mailto:ian@rumford.name" title="mailto: ian@rumford.name"><i class="fa fa-envelope-square fa-3x"></i></a>&nbsp;
  
  
  <a href="https://github.com/ianrumford" title="GithubID: ianrumford"><i class="fa fa-github-square fa-3x"></i></a>&nbsp;
  
  
  <a href="https://twitter.com/ianrumford" title="TwitterID: ianrumford"><i class="fa fa-twitter-square fa-3x"></i></a>
  

  

</div>

<div class="sidebar-module">
  <h4>Site Search</h4>
  <form onsubmit="search_google()" >
    <input type="text" id="google-search" placeholder="Google search" />
    <input type="submit" name="sa" value="Go" />
  </form>
</div>


<div class="sidebar-module"> <!-- sidebar-module-inset">-->
  <h4>Copyright Notice</h4>

  

  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
    <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png">
  </a>
  <br />
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-NonCommercial-ShareAlike</a>

  

</div>


<div class="sidebar-module">
  <h4>Recent Posts</h4>
  
  <li>
  <a href="/elixir/doctest/individual/2017/11/20/testing-individual-elixir-doctests.html" title="Testing Individual Elixir Doctests" rel="bookmark">Testing Individual Elixir Doctests</a>
  </li>
  
  <li>
  <a href="/elixir/metaprogramming/postwalk/2017/05/17/metaprogramming-without-macros.html" title="Metaprogramming Without Macros" rel="bookmark">Metaprogramming Without Macros</a>
  </li>
  
  <li>
  <a href="/elixir/siariwyd/callback/function/share/reuse/2016/11/17/siariwyd.html" title="Sharing and Reusing Elixir Callback Functions between Modules" rel="bookmark">Sharing and Reusing Elixir Callback Functions between Modules</a>
  </li>
  
  <li>
  <a href="/elixir/pattern/matching/runtime/polymorphism/2016/09/19/pattern-matching-to-polymorphism.html" title="Pattern Matching to Polymorphism - an Unexpected Journey" rel="bookmark">Pattern Matching to Polymorphism - an Unexpected Journey</a>
  </li>
  
  <li>
  <a href="/elixir/map/api/genserver/module/agent/state/2016/09/13/amlapio.html" title="Adding a Map API to a GenServer or Module with Agent-held State" rel="bookmark">Adding a Map API to a GenServer or Module with Agent-held State</a>
  </li>
  
</div>


<div class="sidebar-module">
  <h4>Tags</h4>
  
    <a href="/tags/#hello world" title="hello world" rel="1">hello world</a> &nbsp;
  
    <a href="/tags/#octopress" title="octopress" rel="1">octopress</a> &nbsp;
  
    <a href="/tags/#jekyll" title="jekyll" rel="1">jekyll</a> &nbsp;
  
    <a href="/tags/#blog" title="blog" rel="1">blog</a> &nbsp;
  
    <a href="/tags/#emacs" title="emacs" rel="2">emacs</a> &nbsp;
  
    <a href="/tags/#Ubuntu" title="Ubuntu" rel="1">Ubuntu</a> &nbsp;
  
    <a href="/tags/#precise" title="precise" rel="2">precise</a> &nbsp;
  
    <a href="/tags/#pangolin" title="pangolin" rel="1">pangolin</a> &nbsp;
  
    <a href="/tags/#12.04" title="12.04" rel="1">12.04</a> &nbsp;
  
    <a href="/tags/#clojure" title="clojure" rel="1">clojure</a> &nbsp;
  
    <a href="/tags/#leinginen" title="leinginen" rel="1">leinginen</a> &nbsp;
  
    <a href="/tags/#slime" title="slime" rel="1">slime</a> &nbsp;
  
    <a href="/tags/#swank" title="swank" rel="1">swank</a> &nbsp;
  
    <a href="/tags/#ubuntu" title="ubuntu" rel="1">ubuntu</a> &nbsp;
  
    <a href="/tags/#ruby" title="ruby" rel="1">ruby</a> &nbsp;
  
    <a href="/tags/#windows" title="windows" rel="1">windows</a> &nbsp;
  
    <a href="/tags/#ole" title="ole" rel="1">ole</a> &nbsp;
  
    <a href="/tags/#property" title="property" rel="1">property</a> &nbsp;
  
    <a href="/tags/#values" title="values" rel="1">values</a> &nbsp;
  
</div>


<div class="sidebar-module">
  <h4>Archives</h4>

  
  
  
  
  
  <li id="2017" > <a href="/archives/#2017">2017</a></li>
  
  
  
  
  
  
  
  
  
  <li id="2016" > <a href="/archives/#2016">2016</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2014" > <a href="/archives/#2014">2014</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2013" > <a href="/archives/#2013">2013</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2012" > <a href="/archives/#2012">2012</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

</div>


</div>



  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/">An Ostler in IT</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> 
  on 
  
  <a href="https://github.com/">Github</a>
  
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="http://yulijia.net">Lijia Yu</a>
  | Adapted by Ian Rumford  


  <div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
    <a title="Back To Top"><img src="/images/topbutton.png"/></a>
  </div>

  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/totop.js"></script>  



</footer>


</div>

</body>

</html>
