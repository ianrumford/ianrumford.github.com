<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">

<meta property="og:title" content="Pattern Matching to Polymorphism - an Unexpected Journey">
<title>Pattern Matching to Polymorphism - an Unexpected Journey</title>
<meta property="og:description" content="When I first started learning  Elixir,  I didn’t begin to appreciate the power of pattern matchinguntil I’d read Sasa’sbook and Dave’sbook. Chapter 5 in Dave...">
<meta property="og:url" content="http://www.rumford.name/elixir/pattern/matching/runtime/polymorphism/2016/09/19/pattern-matching-to-polymorphism.html">
<meta property="og:site_name" content="An Ostler in IT">
<meta property="og:locale" content="en_UK">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ianrumford">
<meta name="twitter:creator" content="@ianrumford">
<meta name="twitter:title" content="Pattern Matching to Polymorphism - an Unexpected Journey">
<meta name="twitter:description" content="When I first started learning  Elixir,  I didn’t begin to appreciate the power of pattern matchinguntil I’d read Sasa’sbook and Dave’sbook. Chapter 5 in Dave...">
<meta name="twitter:url" content="http://www.rumford.name/elixir/pattern/matching/runtime/polymorphism/2016/09/19/pattern-matching-to-polymorphism.html">

<meta name="keywords" content="IT Ostler Horses Courses">

<link rel="icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://www.rumford.name/elixir/pattern/matching/runtime/polymorphism/2016/09/19/pattern-matching-to-polymorphism.html">
<link rel="alternate" type="application/atom+xml" title="An Ostler in IT" href="http://www.rumford.name/feed.xml" />

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script language="Javascript" type="text/javascript">
function search_google()
{
  var query = document.getElementById("google-search").value;
  window.open("http://google.com/search?q=" + query
      + "%20site:" + "http://www.rumford.name");
}
</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>


<script type='text/javascript'>
var blocklink = ['http://humanorightswatch.org','http://o-o-6-o-o.com','http://darodar.com','http://blackhatworth.com','http://hulfingtonpost.com','http://bestwebsitesawards.com','http://darodar.com','http://buttons-for-website.com','http://ilovevitaly.co','http://semalt.com','http://priceg.com','http://simple-share-buttons.com','http://googlsucks.com','http://4webmasters.org','http://aliexpress.com','http://addons.mozilla.org/en-US/firefox/addon/ilovevitaly/','http://free-share-buttons.com','http://buttons-for-your-website.com','http://theguardlan.com','http://buy-cheap-online.info','http://best-seo-offer.com','http://4webmasters.org','http://trafficmonetize.org','http://howtostopreferralspam.eu','http://ilovevitaly.com','http://sanjosestartups.com','http://free-social-buttons.com','http://best-seo-offer.com','http://guardlink.org','http://www.event-tracking.com','http://www3.free-social-buttons.com','http://www1.free-social-buttons.com','http://www2.free-social-buttons.com','http://websites-reviews.com','http://floating-share-buttons.com','http://satellite.maps.ilovevitaly.com','http://free-social-buttons.com','http://www.event-tracking.com','http://erot.co'];
for (var b = blocklink.length; b--;) {
  if (document.referrer.match(blocklink[b]))
    window.location = "http://www.google.com";
}
</script>



<link type="application/atom+xml" rel="alternate" href="http://www.rumford.name/atom.xml" title="An Ostler in IT" />
</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">An Ostler in IT</a></h1>
    <h3 class="site-meta">Horses for Courses</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">Home</a>
        
        
        
        <a class="page-link" href="/about/">About</a>
        
        
        
        <a class="page-link" href="/archives/">Archives</a>
        
        
        
        <a class="page-link" href="/categories/">Categories</a>
        
        
        
        <a class="page-link" href="/tags/">Tags</a>
        
        
        
        <a class="page-link" href="/guestbook/"></a>
        
        
        
        <a class="page-link" href="/feed.xml"></a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name" class="post-title">Pattern Matching to Polymorphism - an Unexpected Journey</h1>
    <meta itemprop="keywords" content="" />
    <p class="post-meta">
    Posted in
    
    <a href="/categories/#elixir">elixir</a>, 
    
    <a href="/categories/#pattern">pattern</a>, 
    
    <a href="/categories/#matching">matching</a>, 
    
    <a href="/categories/#runtime">runtime</a>, 
    
    <a href="/categories/#polymorphism">polymorphism</a>
     
    
    <time itemprop="datePublished" datetime="2016-09-19">
    on Sep 19, 2016
    </time>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <p>When I first started learning  <a href="http://elixir-lang.org/">Elixir</a>,  I didn’t begin to appreciate the power of pattern matching
until I’d read <a href="http://theerlangelist.com/">Sasa’s</a>
<a href="https://www.manning.com/books/elixir-in-action">book</a> and <a href="https://pragdave.me/">Dave’s</a>
<a href="https://pragprog.com/book/elixir/programming-elixir">book</a>. Chapter 5 in Dave’s book had some
really good prose explaining pattern matching the arguments of anonymous and
(Chapter 6) named functions.</p>

<p>But it took me a while to assimilate what the Elixir (and <a href="http://www.erlang.org/">Erlang</a>)
books were telling me, so I started writing my Elixir functions
rather ignorant of how I could better structure them.</p>

<p>But as ignorance was displaced by experience with Elixir, I started to use pattern
matching for functions all over the place, once I’d “seen” that many of
my functions were variations (<em>variants</em>) on the same theme, really families of functions 
with the same purpose.</p>

<p>After a while of using <em>bread’n’butter</em> function matching, I found I’d
developed a style of using pattern matching to create a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>
with its own set of <em>verbs</em>.</p>

<p>Then I’d write dsl programs using the <em>verbs</em>. Coffee anyone?</p>

<!-- more -->

<h1 id="my-very-own-drink-makera-idorgheadline1a">My very own Drink Maker<a id="orgheadline1"></a></h1>

<blockquote>
  <p>I’m using the example a (virtual) Drink Maker. Its not the real application
that took me on my “unexpected journey”, but it demonstrates what I
want to show in a (I hope) simple way.</p>
</blockquote>

<p>Have a look at the <strong>CoffeeMaker</strong> <em>drink dsl</em> module below which has
a number of variants of the same function <em>make_drink</em>.</p>

<p><em>make_drink</em> is passed a <em>state</em> (a <a href="http://elixir-lang.org/docs/stable/elixir/Map.html">map</a>), a dsl <em>verb</em> (an
<a href="http://elixir-lang.org/getting-started/basic-types.html#atoms">atom</a> e.g. <em>boil_water</em>) and an optional
<a href="http://elixir-lang.org/docs/stable/elixir/Keyword.html">keyword</a> list of arguments (<em>opts</em>). All the <em>make_drink</em> variants have the same signature and return the
(usually changed) <em>state</em>.  A familiar enough (recursive) pattern and pretty
simple stuff, but highly effective.</p>

<p><em>make_drink</em> pattern matches on the <em>verb</em> (but could also use
the contents of the <em>state</em>).</p>

<p>The variant <em>make_instant_coffee</em> runs an `Enum.reduce/3` with another
set of <em>verbs</em> specific to that recipe. The last thing it does is set
the <em>:ready_drink</em> key in the <em>state</em> to <em>:instant_coffee</em> – I’ll use
this value in the testing later on.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="k">defmodule</span> <span class="no">CoffeeMaker</span> <span class="k">do</span>
  <span class="c1"># header</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">opts</span> <span class="p">\\</span> <span class="p">[])</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:boil_water</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># blah</span>
    <span class="n">state</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:wash_cup</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># blah</span>
    <span class="n">state</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:add_instant_coffee_to_cup</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># blah</span>
    <span class="n">state</span>
  <span class="k">end</span>
  <span class="c1"># more steps (verbs) in the recipe </span>

  <span class="c1"># this variant recursively calls make_drink</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:make_instant_coffee</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">[</span><span class="ss">:boil_water</span><span class="p">,</span> <span class="ss">:wash_cup</span><span class="p">,</span> <span class="ss">:add_instant_coffee_to_cup</span><span class="p">,</span>
       <span class="c1"># more verbs here</span>
    <span class="p">]</span>
    <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="k">fn</span> <span class="n">verb</span><span class="p">,</span> <span class="n">state</span> <span class="o">-&gt;</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
    <span class="c1"># mark the drink ready</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:ready_drink</span><span class="p">,</span> <span class="ss">:instant_coffee</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Lets have coffee!</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c1"># make an instant coffee</span>
<span class="p">%{}</span> <span class="o">|&gt;</span> <span class="no">CoffeeMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="ss">:make_instant_coffee</span><span class="p">)</span> <span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<blockquote>
  <p>Yes I know <em>real</em> developers supposedly don’t drink instant coffee but, hey, we’re a broad church :)</p>
</blockquote>

<h1 id="diaster-strikesa-idorgheadline2a">Diaster Strikes!<a id="orgheadline2"></a></h1>

<p>The dsl style worked really well and I created other dsl programs to make
different types of coffee (<em>hot, iced, espresso, latte, etc</em>).</p>

<p>Then disaster struck. Already, at the back of my mind, I’d been a bit
worried at the growing line count of the <strong>CoffeeMaker</strong> module; it
was becoming unmanageable.</p>

<p>But the clincher came when I realised I
wanted to be able to use my <em>drink dsl</em> in other applications (e.g. a <strong>TeaMaker</strong>) and
enable those applications to make new drinks, adding their own
recipes (<em>make_drink</em>) for <em>tea, juice, beers, cocktails</em>, whatever. And also
maybe selectively modify existing <em>verbs</em>  in the base recipes (e.g there lots of different ways to <em>boil_water</em>).</p>

<p>I wanted to allow any <em>drink dsl</em> module to be able to
use normal pattern matching in its own code,
but also call the verbs in other <em>drink dsl</em> modules, something like
this where <strong>TeaMaker</strong> needs to use some verbs from <strong>CoffeeMaker</strong></p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">defmodule</span> <span class="no">TeaMaker</span> <span class="k">do</span>
  <span class="c1"># header</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">opts</span> <span class="p">\\</span> <span class="p">[])</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:add_earl_grey_tea_bag</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># blah</span>
    <span class="n">state</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:brew_for_3_minutes</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># blah</span>
    <span class="n">state</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:make_earl_grey_tea</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">[</span><span class="ss">:boil_water</span><span class="p">,</span> <span class="ss">:wash_cup</span><span class="p">,</span> <span class="ss">:add_earl_grey_tea_bag</span><span class="p">,</span> <span class="ss">:brew_for_3_minutes</span><span class="p">,</span>
       <span class="c1"># more verbs here</span>
    <span class="p">]</span>
    <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="k">fn</span> <span class="n">verb</span><span class="p">,</span> <span class="n">state</span> <span class="o">-&gt;</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
    <span class="c1"># mark the drink ready</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:ready_drink</span><span class="p">,</span> <span class="ss">:earl_grey_tea</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Tea time!</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c1"># make a cup of earl grey tea</span>
<span class="p">%{}</span> <span class="o">|&gt;</span> <span class="no">TeaMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="ss">:make_earl_grey_tea</span><span class="p">)</span> <span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Fail! This wont work of course because pattern matching on functions is
scoped to the module and <strong>TeaMaker</strong> has no access to 
<strong>CoffeeMaker’s</strong> <em>make_drink</em> so <em>boil_water</em> and <em>wash_cup</em> will fail
to pattern match.</p>

<p>Thinking how to get around this, I considered  making the list of steps in the recipe (partial) functions
rather than verbs, but it starts
tightly coupling verbs to modules, and visually looks a bit of a mess
and difficult to parse by eye. In short: <em>yuck!</em></p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:make_earl_grey_tea</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="o">&amp;</span><span class="p">(</span><span class="no">CoffeeMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="ss">:boil_water</span><span class="p">)),</span>
    <span class="o">&amp;</span><span class="p">(</span><span class="no">CoffeeMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="ss">:wash_cup</span><span class="p">)),</span>
    <span class="o">&amp;</span><span class="p">(</span><span class="no">TeaMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="ss">:add_earl_grey_tea_bag</span><span class="p">)),</span>
    <span class="c1"># more funs here</span>
  <span class="p">]</span>
  <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(%{},</span> <span class="k">fn</span> <span class="n">fun</span><span class="p">,</span> <span class="n">state</span> <span class="o">-&gt;</span> <span class="n">fun</span><span class="o">.</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Or I could go back to having unique, explicit functions I could call from any
where but that felt horrible too.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">def</span> <span class="n">make_drink_boil_water</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># blah</span>
  <span class="n">state</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>I also thought about structuring the dsl
into a hierarchical form such as a module for the different ways of boiling water, one
for cleaning the cups, and so on.</p>

<p>But everthing I thought of introduced
constraints, confusion and complexity into what was currently
quite a simple, easy to understand and elegant solution.</p>

<h1 id="creating-a-drinks-menua-idorgheadline10a">Creating a Drinks Menu<a id="orgheadline10"></a></h1>

<p>To maintain the simplicity of an apparently “global” <em>make_drink</em> function, I
needed to collect all the <em>make_drink</em> variants with different <em>verbs</em> from <strong>CoffeeMaker</strong>,
<strong>TeaMaker</strong>, and any other <em>drink dsl</em> module, into a combined <em>drinks_menu</em>,
and use the combined <em>drinks_menu</em> when I need to find the <em>make_drink</em> variant for a particular <em>verb</em> (e.g. <em>boil_water</em>).</p>

<p>Somehow I needed to</p>

<ol>
  <li>
    <p>identify the various <em>make_drink</em> variants from each <em>drink dsl</em> module</p>
  </li>
  <li>
    <p>save their details in their own <em>drinks_menu</em></p>
  </li>
  <li>
    <p>combine the modules’ <em>drinks_menus</em></p>
  </li>
  <li>
    <p>make the combined <em>drinks_menu</em>  accessible by all the modules</p>
  </li>
</ol>

<p>But I didn’t want to have to have write the <em>make_drink</em> variants in radically different ways to
be usable either within the module or from another module. (“Pro cake and pro eating it”)</p>

<h2 id="building-a-modules-drinksmenua-idorgheadline3a">Building a module’s <em>drinks_menu</em><a id="orgheadline3"></a></h2>

<p>By “save the details” I mean: the <strong>module</strong> the <em>make_drink</em> variant was defined in,
its <strong>verb</strong> and any <strong>other arguments</strong>.</p>

<p>I decided to save the details using the MFA (module, function, arguments list)
format that you can use with <a href="http://elixir-lang.org/docs/stable/elixir/Kernel.html#apply/3">`Kernel.apply/3`</a> to call the function.</p>

<p>For example, the MFA 3tuple for the <em>boil_water</em> variant in <strong>CofffeeMaker</strong> would be</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="ss">:boil_water</span><span class="p">,</span> <span class="n">opts</span><span class="p">]}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The <em>state</em> and <em>opts</em> are variable so I’ve abbreviated the stored MFA
to hold only the “constant” elements like the <em>verb</em>, and leave the variable
arguments to be supplied at the time of use (see later).</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="ss">:boil_water</span><span class="p">]}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>All of the <em>make_drink</em> variants for a module can then be held in a module-specific <em>drinks_menu</em> (a map), keyed on the verb e.g. for <strong>CofffeeMaker</strong></p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">drinks_menu</span> <span class="o">=</span>
  <span class="p">%{</span><span class="ss">boil_water:</span> <span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="ss">:boil_water</span><span class="p">]},</span>
    <span class="ss">wash_cup:</span> <span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="ss">:wash_cup</span><span class="p">]},</span>
    <span class="ss">add_instant_coffee_to_cup:</span> <span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="ss">:add_instant_coffee_to_cup</span><span class="p">]},</span>
    <span class="ss">make_instant_coffee:</span> <span class="p">{</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="ss">:make_instant_coffee</span><span class="p">]}}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Its worth stressing the <em>drinks menu</em> is just a plain map you can <em>get</em>, <em>put</em>, etc the verbs, and the values can
be whatever you like; interpreting the values is a job for some other
code (I’ll come on to that).</p>

<p>Also the value is not necessarily dependent (coupled) in any way on the verb
itself, and one could have other non-MFA values. One obvious non-MFA
value would be an anonymous function:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="ss">add_two_sugars:</span>  <span class="k">fn</span> <span class="n">state</span> <span class="o">-&gt;</span>
                      <span class="c1"># do something with state</span>
                      <span class="n">state</span>

                    <span class="n">state</span><span class="p">,</span> <span class="n">opts</span> <span class="o">-&gt;</span>
                      <span class="c1"># do something with state &amp; opts</span>
                      <span class="n">state</span>
                 <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="saving-the-modules-drinksmenu-in-a-persistent-module-attributea-idorgheadline4a">Saving the module’s <em>drinks_menu</em> in a persistent module attribute<a id="orgheadline4"></a></h2>

<p>The module’s <em>drinks_menu</em> is built at compile time but needs to be available at run time.</p>

<p>I bumped into how to do this while reading Chapter 2 of
<a href="https://twitter.com/chris_mccord">Chris’s</a> <a href="https://pragprog.com/book/cmelixir/metaprogramming-elixir">metaprogramming book</a> 
but the <em>:persist</em> option of
<a href="http://elixir-lang.org/docs/stable/elixir/Module.html#register_attribute/3">`Module.register_attribute/3`</a> is
in the reference documentation.</p>

<p>Simply, if you register a module attribute, e.g. @drinks_menu, with the <em>persist: true</em> option,</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="k">defmodule</span> <span class="no">CoffeeMaker</span> <span class="k">do</span>

  <span class="c1"># register the drinks_menu attribute with the persistent option</span>
  <span class="no">Module</span><span class="o">.</span><span class="n">register_attribute</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:drinks_menu</span><span class="p">,</span> <span class="ss">persist:</span> <span class="no">true</span><span class="p">)</span>

  <span class="c1"># initialize the drinks_menu</span>
  <span class="no">Module</span><span class="o">.</span><span class="n">put_attribute</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:drinks_menu</span><span class="p">,</span> <span class="p">%{})</span>

  <span class="c1"># all the /make_drink/ variants, etc here</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>… you can get the value of <em>drinks_menu</em> at run time using the module’s <a href="http://elixir-lang.org/docs/stable/elixir/Module.html#__info__/1">__info__</a> function called with <em>:attributes</em></p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="c1"># get module's e.g. CoffeeMaker drinks_menu at run time</span>
<span class="k">def</span> <span class="n">get_drinks_menu</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">do</span>
  <span class="ss">:attributes</span>
  <span class="o">|&gt;</span> <span class="n">module</span><span class="o">.</span><span class="n">__info__</span>
  <span class="o">|&gt;</span> <span class="no">Keyword</span><span class="o">.</span><span class="n">fetch!</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">)</span>
  <span class="c1"># persist always seems to make the attribute a List of one item</span>
  <span class="o">|&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="collecting-the-details-of-the-makedrink-variantsa-idorgheadline7a">Collecting the details of the <em>make_drink</em> variants<a id="orgheadline7"></a></h2>

<p>I’ve talked about how I’d save the details of the
<em>make_drink</em> variants in the <em>drinks_menu</em> but not how I’d find out what they are in the
first place.</p>

<p>I needed to be able to run some of my code when a new
<em>make_drink</em> variant was defined so I could save its details in the <em>drinks_menu</em>.</p>

<p>I’d already done this sort of thing in
<a href="https://www.ruby-lang.org">Ruby</a> (at run-time of course) using <strong>Module’s</strong>
<a href="http://ruby-doc.org/core-2.3.1/Module.html#method-i-method_added">#method_added</a>.</p>

<p>Well it turns out
that Elixir has the same (compile-time) functionality: 
<a href="http://elixir-lang.org/docs/stable/elixir/Module.html#module-compile-callbacks">Module’s compiler callback</a>  <em>@on_definition</em> registers the
callback function (e.g. <em>make_drink_on_def_callback</em> in the example below) the
compiler will call when a variant is defined.</p>

<h3 id="the-ondefinition-callback-functiona-idorgheadline5a">The @on_definition callback function<a id="orgheadline5"></a></h3>

<p>The callback is passed all the information you could wish for in a comprehensive list of six arguments:</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">ArgName</th>
<th scope="col" class="org-left">Contents</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left">env</td>
<td class="org-left">the module environment - think __ENV__</td>
</tr>


<tr>
<td class="org-left">kind</td>
<td class="org-left">one of :def, :defp, :defmacro, or :defmacrop</td>
</tr>


<tr>
<td class="org-left">name</td>
<td class="org-left">the function's name</td>
</tr>


<tr>
<td class="org-left">args</td>
<td class="org-left">quoted arguments</td>
</tr>


<tr>
<td class="org-left">guards</td>
<td class="org-left">quoted guard clauses</td>
</tr>


<tr>
<td class="org-left">body</td>
<td class="org-left">quoted body</td>
</tr>
</tbody>
</table>

<p>The callback will be called for <strong>all</strong> functions, not just <em>make_drink</em>,
but simple pattern matching on the <em>name</em> (i.e. <em>make_drink</em>) allows the selection of wanted
variants.</p>

<p>The <em>args</em> value will be a list:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">[{</span><span class="ss">:state</span><span class="p">,</span> <span class="p">[</span><span class="ss">line:</span> <span class="m">12</span><span class="p">],</span> <span class="no">nil</span><span class="p">},</span> <span class="ss">:boil_water</span><span class="p">,</span> <span class="p">{</span><span class="ss">:opts</span><span class="p">,</span> <span class="p">[</span><span class="ss">line:</span> <span class="m">12</span><span class="p">],</span> <span class="no">nil</span><span class="p">}]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Remember these are <a href="http://elixir-lang.org/getting-started/meta/quote-and-unquote.html">quoted</a> so the <em>state</em> and <em>opts</em> arguments are in <a href="http://elixir-lang.org/docs/stable/elixir/Macro.html#var/2">`Macro.var/2`</a> format. The body is similarly <a href="http://elixir-lang.org/getting-started/meta/quote-and-unquote.html">quoted</a>.</p>

<p>Here is the callback’s code (note the return value is ignored).</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="c1"># add new make_drink variants to the drinks_menu</span>
<span class="k">def</span> <span class="n">make_drink_on_def_callback</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="ss">:def</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">_guards</span><span class="p">,</span> <span class="n">_body</span><span class="p">)</span> <span class="k">do</span>

  <span class="c1"># the calling module e.g. CoffeeMaker is the env's module key</span>
  <span class="n">env_module</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">module</span>

  <span class="c1"># the verb is the second item in the args</span>
  <span class="n">verb</span> <span class="o">=</span> <span class="n">args</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

  <span class="c1"># update the current drinks_menu with new entry</span>
  <span class="n">drinks_menu</span> <span class="o">=</span> <span class="n">env_module</span>
  <span class="o">|&gt;</span> <span class="no">Module</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">)</span>
  <span class="c1"># add the new verb + MFA 3tuple</span>
  <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="p">{</span><span class="n">env_module</span><span class="p">,</span> <span class="ss">:make_drink</span><span class="p">,</span> <span class="p">[</span><span class="n">verb</span><span class="p">]})</span>

  <span class="c1"># save the update drinks_menu in the persistent attribute</span>
  <span class="n">env_module</span> <span class="o">|&gt;</span> <span class="no">Module</span><span class="o">.</span><span class="n">put_attribute</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">,</span> <span class="n">drinks_menu</span><span class="p">)</span>

<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="registering-the-ondefinition-callbacka-idorgheadline6a">Registering the @on_definition callback<a id="orgheadline6"></a></h3>

<p>To register the callback for the module is quite simple:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nv">@on_definition</span> <span class="p">{</span><span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span><span class="p">,</span> <span class="ss">:make_drink_on_def_callback</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="pulling-all-the-drinksmenu-code-togethera-idorgheadline8a">Pulling all the <em>drinks_menu</em> code together<a id="orgheadline8"></a></h2>

<p>Since all the <em>drink dsl</em> modules will need to register the @on_definition callback,
create the <em>drinks_menu</em>, etc, its more useful to put all <em>drinks_menu</em> code, including the
callback, in a utility module: <strong>DrinkMaker.Menu</strong>. (I’ve not shown the complete module here as much has already been shown above.)</p>

<h2 id="generating-a-modules-drinksmenua-idorgheadline9a">Generating a module’s <em>drinks_menu</em><a id="orgheadline9"></a></h2>

<p>Generating the <em>drinks_menu</em> in any <em>drink dsl</em> module is then just a
matter of <em>use</em>-ing <strong>DrinkMaker.Menu</strong> <strong>before</strong> the <em>make_drink</em>
variants are defined e.g.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="k">defmodule</span> <span class="no">CoffeeMaker</span> <span class="k">do</span>

  <span class="c1"># build the drinks_menu</span>
  <span class="kn">use</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span>

  <span class="c1"># CoffeeMaker's make_drink variants, etc go here</span>
  <span class="c1"># (not shown for brevity)</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="creating-a-combined-drinksmenua-idorgheadline11a">Creating a combined <em>drinks_menu</em><a id="orgheadline11"></a></h1>

<p>Creating a combined <em>drinks_menu</em> is just a matter of unifying the individual <em>drinks_menus</em> into one.</p>

<blockquote>
  <p>The <em>drinks_menu</em> is really a dictionaries of transformations that can be run
in an e.g. <a href="http://elixir-lang.org/docs/stable/elixir/Enum.html#reduce/3">`Enum.reduce/3`</a> pipeline (i.e one or more verbs) against a supplied <em>state</em></p>
</blockquote>

<p>Since the drinks menus are maps, they could be merged using  <a href="http://elixir-lang.org/docs/stable/elixir/Map.html#merge/2">`Map.merge/2`</a>. Alternatively, one
could e.g. <em>take</em> or <em>drop</em> verbs as needed and combine them that way.</p>

<p>How the combination is done depends on the application’s need and there is nothing to prevent the creation of different menus
for different purposes e.g. <em>hot_drinks_menu</em>, <em>cold_drinks_menu</em>, 
<em>free_drinks_menu</em>, <em>paid_drinks_menu</em>, whatever.</p>

<p>Here the drinks_menus are just merged:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="c1"># need to require all the drinks dsl module to ensure the individual</span>
<span class="c1"># modules' drinks_menus have been created</span>
<span class="kn">require</span> <span class="no">CoffeeMaker</span>
<span class="kn">require</span> <span class="no">TeaMaker</span>
<span class="c1"># require any other drink dsl modules</span>

<span class="c1"># create drinks_menu as a module attribute</span>
<span class="nv">@drinks_menu</span> <span class="p">[</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="no">TeaMaker</span><span class="p">]</span>
<span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">fn</span> <span class="n">module</span> <span class="o">-&gt;</span> <span class="n">module</span> <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span><span class="o">.</span><span class="n">get_drinks_menu</span> <span class="k">end</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(%{},</span> <span class="k">fn</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span> <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="using-a-combined-drinksmenua-idorgheadline12a">Using a combined <em>drinks_menu</em><a id="orgheadline12"></a></h1>

<p>To make drinks from a combined <em>drinks_menu</em> needs a helper function — defined for convenience in the <strong>DrinkMaker.Menu</strong>
and also, but not necessarily, called <em>make_drink</em> —
to find the <em>verbs</em> and call (usually) the right <em>drink dsl</em> module’s <em>make_drink</em> variant.</p>

<p>Note, the helper expects to find the <em>drinks_menu</em> in the <em>state</em>.</p>

<p>Its worth stressing the helper doesn’t “know” about the <em>make_drink</em>
function and its variants; it
only uses the values in the <em>drinks_menu</em> i.e the MFA 3tuple (usually)
where the function to call in the 2nd element.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></td><td class="code"><pre><span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span> <span class="p">\\</span> <span class="p">[])</span> <span class="k">do</span>

  <span class="c1"># the drinks_menu must be in the state</span>
  <span class="n">drinks_menu</span> <span class="o">=</span> <span class="n">state</span> <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">fetch!</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">)</span>

  <span class="c1"># reduce the state using the values of the verbs</span>
  <span class="c1"># in the drinks_menu</span>
  <span class="n">verbs</span>
  <span class="o">|&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">wrap</span>
  <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
  <span class="k">fn</span> <span class="n">verb</span><span class="p">,</span> <span class="n">state</span> <span class="o">-&gt;</span>

    <span class="c1"># must find the verb in the drinks_menu</span>
    <span class="k">case</span> <span class="n">drinks_menu</span> <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">fetch!</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span> <span class="k">do</span>

      <span class="c1"># is the verb's value a MFA 3tuple?</span>
      <span class="c1"># note: the fun_name will always be make_drink in this example</span>
      <span class="c1"># but the code works for any fun_name</span>
      <span class="p">{</span><span class="n">module</span><span class="p">,</span> <span class="n">fun_name</span><span class="p">,</span> <span class="n">mfa_args</span><span class="p">}</span> <span class="o">-&gt;</span>

        <span class="c1"># create the complete arguments list</span>
        <span class="n">all_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">++</span> <span class="n">mfa_args</span> <span class="o">++</span> <span class="p">[</span><span class="n">opts</span><span class="p">]</span>

        <span class="c1"># run the function</span>
        <span class="n">apply</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">fun_name</span><span class="p">,</span> <span class="n">all_args</span><span class="p">)</span>

      <span class="c1"># is the verb's value a fun?</span>
      <span class="n">fun</span> <span class="ow">when</span> <span class="n">is_function</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fun</span><span class="o">.</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
      <span class="n">fun</span> <span class="ow">when</span> <span class="n">is_function</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fun</span><span class="o">.</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>

      <span class="c1"># no default =&gt; error</span>

    <span class="k">end</span>

  <span class="k">end</span><span class="p">)</span>

<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>To see how the helper would be used, let briefly revisit <strong>TeaMaker’s</strong> <em>make_earl_grey_tea</em> variant, the one
above that failed because it needed to call verbs in <strong>CoffeeMaker</strong>. Assuming the state passed
to <strong>TeaMaker’s</strong> <em>make_earl_grey_tea</em> now holds the <em>drinks_menu</em>, the variant
would be rewritten to use `DrinkMaker.Menu.make_drink/3` (as
would any other variant that needed to call <em>make_drink</em> variants in other <em>drink dsl</em> modules).</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="c1"># this is the TeaMaker variant rewritten to use the DrinkMaker.Menu helper</span>
<span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="ss">:make_earl_grey_tea</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">verbs</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:boil_water</span><span class="p">,</span> <span class="ss">:wash_cup</span><span class="p">,</span> 
           <span class="ss">:add_earl_grey_tea_bag</span><span class="p">,</span> <span class="ss">:brew_for_3_minutes</span><span class="p">,</span>
           <span class="c1"># more verbs here</span>
          <span class="p">]</span>
  <span class="n">state</span> 
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="c1"># mark the drink ready</span>
  <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:ready_drink</span><span class="p">,</span> <span class="ss">:earl_grey_tea</span><span class="p">)</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<blockquote>
  <p>The state could hold many drinks menus  and the
decision on which one to use taken by the variant, the helper, whatever
and based on any criteria.</p>
</blockquote>

<h1 id="the-drinkmaker-genservera-idorgheadline13a">The DrinkMaker GenServer<a id="orgheadline13"></a></h1>

<p>To show a testable example, I’ve created a <a href="http://elixir-lang.org/getting-started/mix-otp/genserver.html">GenServer</a> to make drinks, holding the <em>drinks_menu</em> in the GenServer’s state.</p>

<p>(I want to have a nice easy Map interface to the <em>drinks_menu</em> so I’ll use my <a href="https://hex.pm/">Hex</a> package <a href="https://hex.pm/packages/amlapio">Amlapio</a>)</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></td><td class="code"><pre><span class="k">defmodule</span> <span class="no">DrinkMaker</span> <span class="k">do</span>

  <span class="kn">use</span> <span class="no">GenServer</span>

  <span class="c1"># need to require all the drinks dsl module to ensure the individual</span>
  <span class="c1"># modules' drinks_menus have been created</span>
  <span class="kn">require</span> <span class="no">CoffeeMaker</span>
  <span class="kn">require</span> <span class="no">TeaMaker</span>
  <span class="c1"># require any other drink dsl modules</span>

  <span class="c1"># create drinks_menu as a module attribute</span>
  <span class="nv">@drinks_menu</span> <span class="p">[</span><span class="no">CoffeeMaker</span><span class="p">,</span> <span class="no">TeaMaker</span><span class="p">]</span>
  <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">fn</span> <span class="n">module</span> <span class="o">-&gt;</span> <span class="n">module</span> <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span><span class="o">.</span><span class="n">get_drinks_menu</span> <span class="k">end</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(%{},</span> <span class="k">fn</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span> <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>

  <span class="c1"># start the GenServer</span>
  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">state</span> <span class="p">\\</span> <span class="p">%{})</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># use Amlapio to generate the accessors and mutators for the drinks_menu and state</span>
  <span class="kn">use</span> <span class="no">Amlapio</span><span class="p">,</span> <span class="ss">funs:</span> <span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:put</span><span class="p">],</span> <span class="ss">genserver_api:</span> <span class="p">[</span><span class="ss">:drinks_menu</span><span class="p">]</span>
  <span class="kn">use</span> <span class="no">Amlapio</span><span class="p">,</span> <span class="ss">funs:</span> <span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:put</span><span class="p">],</span> <span class="ss">genserver_api:</span> <span class="no">nil</span><span class="p">,</span>
    <span class="ss">namer:</span> <span class="k">fn</span> <span class="n">_map_name</span><span class="p">,</span> <span class="n">fun_name</span> <span class="o">-&gt;</span> 
    <span class="p">[</span><span class="sd">"</span><span class="s2">drink_maker_state_"</span><span class="p">,</span> <span class="n">to_string</span><span class="p">(</span><span class="n">fun_name</span><span class="p">)]</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">join</span> <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">to_atom</span>
  <span class="k">end</span>

  <span class="c1"># &lt;&lt; more API calls &gt;&gt;</span>

  <span class="k">def</span> <span class="n">make_drink</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span> <span class="p">\\</span> <span class="p">[])</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:make_drink</span><span class="p">,</span> <span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span><span class="p">})</span>
  <span class="k">end</span>

  <span class="c1"># GenServer Callbacks</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">state</span> <span class="p">\\</span> <span class="p">%{})</span> <span class="ow">when</span> <span class="n">is_map</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># merge the drinks_menu to the state</span>
    <span class="n">drinks_menu</span> <span class="o">=</span> <span class="n">state</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">,</span> <span class="p">%{})</span>
    <span class="c1"># any drinks_menu in the state overrides the default drinks_menu</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="nv">@drinks_menu</span><span class="p">,</span> <span class="k">fn</span> <span class="n">_k</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">_v2</span> <span class="o">-&gt;</span> <span class="n">v1</span> <span class="k">end</span><span class="p">)</span>

    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">state</span> <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:drinks_menu</span><span class="p">,</span> <span class="n">drinks_menu</span><span class="p">)}</span>
  <span class="k">end</span>

  <span class="c1"># make_drink's handle_call</span>
  <span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:make_drink</span><span class="p">,</span> <span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span><span class="p">},</span> <span class="n">_fromref</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
    <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="no">Menu</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="n">verbs</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>

    <span class="c1"># reply with result self and (updated) state</span>
    <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="n">self</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>    

  <span class="k">end</span>

  <span class="c1"># use Amlapio to generate the accessors and mutators for the drinks_menu</span>
  <span class="kn">use</span> <span class="no">Amlapio</span><span class="p">,</span> <span class="ss">funs:</span> <span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:put</span><span class="p">],</span> <span class="ss">genserver_handle_call:</span> <span class="p">[</span><span class="ss">:drinks_menu</span><span class="p">]</span>
  <span class="kn">use</span> <span class="no">Amlapio</span><span class="p">,</span> <span class="ss">funs:</span> <span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:put</span><span class="p">],</span> <span class="ss">genserver_handle_call:</span> <span class="no">nil</span><span class="p">,</span>
    <span class="ss">namer:</span> <span class="k">fn</span> <span class="n">_map_name</span><span class="p">,</span> <span class="n">fun_name</span> <span class="o">-&gt;</span> 
    <span class="p">[</span><span class="sd">"</span><span class="s2">drink_maker_state_"</span><span class="p">,</span> <span class="n">to_string</span><span class="p">(</span><span class="n">fun_name</span><span class="p">)]</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">join</span> <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">to_atom</span>
  <span class="k">end</span>

<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="testing-the-drinkmaker-genservera-idorgheadline14a">Testing the DrinkMaker GenServer<a id="orgheadline14"></a></h1>

<p>In this test Jane and Lucy set their favourite drink and then make it.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="n">test</span> <span class="sd">"</span><span class="s2">drink_maker"</span> <span class="k">do</span>

  <span class="c1"># create a drink maker for Jane and Lucy</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">janes_drink_maker</span><span class="p">}</span> <span class="o">=</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">start_link</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">lucys_drink_maker</span><span class="p">}</span> <span class="o">=</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">start_link</span>

  <span class="c1"># add Jane's favourite drink (instant coffee) to her drinks menu</span>
  <span class="n">instant_cofffe_recipe</span> <span class="o">=</span>
    <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drinks_menu_get</span><span class="p">(</span><span class="n">janes_drink_maker</span><span class="p">,</span> <span class="ss">:make_instant_coffee</span><span class="p">)</span>

  <span class="n">assert</span> <span class="n">janes_drink_maker</span> <span class="o">==</span> <span class="n">janes_drink_maker</span>
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drinks_menu_put</span><span class="p">(</span><span class="ss">:make_my_favourite_drink</span><span class="p">,</span> <span class="n">instant_cofffe_recipe</span><span class="p">)</span> 

  <span class="c1"># Lucy prefers Earl Grey tea</span>
  <span class="n">earl_grey_tea_recipe</span> <span class="o">=</span>
    <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drinks_menu_get</span><span class="p">(</span><span class="n">janes_drink_maker</span><span class="p">,</span> <span class="ss">:make_earl_grey_tea</span><span class="p">)</span>

  <span class="n">assert</span> <span class="n">lucys_drink_maker</span> <span class="o">==</span> <span class="n">lucys_drink_maker</span> 
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drinks_menu_put</span><span class="p">(</span><span class="ss">:make_my_favourite_drink</span><span class="p">,</span> <span class="n">earl_grey_tea_recipe</span><span class="p">)</span>

  <span class="c1"># now can make their favourite drink in a polymorphic way</span>
  <span class="n">assert</span> <span class="n">janes_drink_maker</span> <span class="o">==</span> <span class="n">janes_drink_maker</span>
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="ss">:make_my_favourite_drink</span><span class="p">)</span>

  <span class="n">assert</span> <span class="n">lucys_drink_maker</span> <span class="o">==</span> <span class="n">lucys_drink_maker</span>
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">make_drink</span><span class="p">(</span><span class="ss">:make_my_favourite_drink</span><span class="p">)</span>

  <span class="c1"># check the drinks are the right ones</span>
  <span class="n">assert</span> <span class="ss">:instant_coffee</span> <span class="o">==</span> <span class="n">janes_drink_maker</span>
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drink_maker_state_get</span><span class="p">(</span><span class="ss">:ready_drink</span><span class="p">)</span>

  <span class="n">assert</span> <span class="ss">:earl_grey_tea</span> <span class="o">==</span> <span class="n">lucys_drink_maker</span>
  <span class="o">|&gt;</span> <span class="no">DrinkMaker</span><span class="o">.</span><span class="n">drink_maker_state_get</span><span class="p">(</span><span class="ss">:ready_drink</span><span class="p">)</span>

<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1 id="how-is-this-polymorphisma-idorgheadline15a">How is this Polymorphism?<a id="orgheadline15"></a></h1>

<p>The GenServer example above shows that 
Jane’s and Lucy’s preferred drink depends on the value of the
<em>make_my_favourite_drink</em> <em>verb</em> in their respective <em>drinks_menu</em>.</p>

<p>This is a example of <a href="http://clojure.org/about/runtime_polymorphism">runtime polymorphism</a>
where the decision on which function to dispatch is determined  from the value of the <em>verb</em> (in the
call to `DrinkMaker.make_drink/3`).</p>

<p><a href="https://twitter.com/richhickey">Rich’s</a> <a href="http:///clojure.org">Clojure</a> documentation <a href="http://clojure.org/about/runtime_polymorphism">says</a>:</p>

<blockquote>
  <p>The basic idea behind runtime polymorphism is that a single function
designator dispatches to multiple independently-defined function
definitions based upon some value of the call.</p>
</blockquote>

<p>(btw the <em>single function designator</em> in my example is `DrinkMaker.Menu.make_drink/3`)</p>

<p>Rich goes on to say:</p>

<blockquote>
  <p>… go further still to allow the dispatch value to be the result of an arbitrary function of the arguments</p>
</blockquote>

<p>It would be trivial to add an arbitrary function to the <em>state</em>,
taking the <em>state</em> and <em>verb</em> as arguments, and use it to decide what
<em>make_drink</em> variant to call, allowing arbitrarily complex <a href="https://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatch</a> 
decisions (albeit maybe with a performance penalty).</p>

<h1 id="final-wordsa-idorgheadline16a">Final Words<a id="orgheadline16"></a></h1>

<p>I’ve focused on just one dispatch function (<em>make_drink</em>) but it
is straightforward to extend the code to other functions as well – I’ve
already done so in the code for the actual project that gave rise to
the idea for this blog post.</p>

<p>I’ve found this really very simple technique to be both flexible
and powerful, especially in providing a simple, open way for multiple
modules and applications
to participate fully in the dsl, adding new, or modifying existing, verbs.</p>

<h1 id="code-on-githuba-idorgheadline17a">Code on Github<a id="orgheadline17"></a></h1>

<p>The <a href="https://github.com/ianrumford/drink_maker">code</a> is on Github:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="nb">cd</span> /tmp
git clone git@github.com:ianrumford/drink_maker.git
<span class="nb">cd </span>drink_maker
mix <span class="nb">test</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>


  </article>
  <hr />
</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/elixir/map/api/genserver/module/agent/state/2016/09/13/amlapio.html" title="Adding a Map API to a GenServer or Module with Agent-held State">&larr; Older</a></li>
    
    
    <li class="next"><a href="/elixir/siariwyd/callback/function/share/reuse/2016/11/17/siariwyd.html" title="Sharing and Reusing Elixir Callback Functions between Modules">Newer &rarr;</a></li>
    
  </ul>
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://www.rumford.name/elixir/map/api/genserver/module/agent/state/2016/09/13/amlapio.html';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://www.rumford.name/elixir/siariwyd/callback/function/share/reuse/2016/11/17/siariwyd.html';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



    <section class="pager">
  
  
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h4>About Me</h4>
  <img title="Whistlejacket" src="/images/whistlejacket-circle-128px-2.png" alt="Whistlejacket"/>
  <span>Ian Rumford's whisperings</span>
  <br />

  

  You can contact me via: <br />

  
  <a href="mailto:ian@rumford.name" title="mailto: ian@rumford.name"><i class="fa fa-envelope-square fa-3x"></i></a>&nbsp;
  
  
  <a href="https://github.com/ianrumford" title="GithubID: ianrumford"><i class="fa fa-github-square fa-3x"></i></a>&nbsp;
  
  
  <a href="https://twitter.com/ianrumford" title="TwitterID: ianrumford"><i class="fa fa-twitter-square fa-3x"></i></a>
  

  

</div>

<div class="sidebar-module">
  <h4>Site Search</h4>
  <form onsubmit="search_google()" >
    <input type="text" id="google-search" placeholder="Google search" />
    <input type="submit" name="sa" value="Go" />
  </form>
</div>


<div class="sidebar-module"> <!-- sidebar-module-inset">-->
  <h4>Copyright Notice</h4>

  

  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
    <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png">
  </a>
  <br />
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-NonCommercial-ShareAlike</a>

  

</div>


<div class="sidebar-module">
  <h4>Recent Posts</h4>
  
  <li>
  <a href="/elixir/doctest/individual/2017/11/20/testing-individual-elixir-doctests.html" title="Testing Individual Elixir Doctests" rel="bookmark">Testing Individual Elixir Doctests</a>
  </li>
  
  <li>
  <a href="/elixir/metaprogramming/postwalk/2017/05/17/metaprogramming-without-macros.html" title="Metaprogramming Without Macros" rel="bookmark">Metaprogramming Without Macros</a>
  </li>
  
  <li>
  <a href="/elixir/siariwyd/callback/function/share/reuse/2016/11/17/siariwyd.html" title="Sharing and Reusing Elixir Callback Functions between Modules" rel="bookmark">Sharing and Reusing Elixir Callback Functions between Modules</a>
  </li>
  
  <li>
  <a href="/elixir/pattern/matching/runtime/polymorphism/2016/09/19/pattern-matching-to-polymorphism.html" title="Pattern Matching to Polymorphism - an Unexpected Journey" rel="bookmark">Pattern Matching to Polymorphism - an Unexpected Journey</a>
  </li>
  
  <li>
  <a href="/elixir/map/api/genserver/module/agent/state/2016/09/13/amlapio.html" title="Adding a Map API to a GenServer or Module with Agent-held State" rel="bookmark">Adding a Map API to a GenServer or Module with Agent-held State</a>
  </li>
  
</div>


<div class="sidebar-module">
  <h4>Tags</h4>
  
    <a href="/tags/#hello world" title="hello world" rel="1">hello world</a> &nbsp;
  
    <a href="/tags/#octopress" title="octopress" rel="1">octopress</a> &nbsp;
  
    <a href="/tags/#jekyll" title="jekyll" rel="1">jekyll</a> &nbsp;
  
    <a href="/tags/#blog" title="blog" rel="1">blog</a> &nbsp;
  
    <a href="/tags/#emacs" title="emacs" rel="2">emacs</a> &nbsp;
  
    <a href="/tags/#Ubuntu" title="Ubuntu" rel="1">Ubuntu</a> &nbsp;
  
    <a href="/tags/#precise" title="precise" rel="2">precise</a> &nbsp;
  
    <a href="/tags/#pangolin" title="pangolin" rel="1">pangolin</a> &nbsp;
  
    <a href="/tags/#12.04" title="12.04" rel="1">12.04</a> &nbsp;
  
    <a href="/tags/#clojure" title="clojure" rel="1">clojure</a> &nbsp;
  
    <a href="/tags/#leinginen" title="leinginen" rel="1">leinginen</a> &nbsp;
  
    <a href="/tags/#slime" title="slime" rel="1">slime</a> &nbsp;
  
    <a href="/tags/#swank" title="swank" rel="1">swank</a> &nbsp;
  
    <a href="/tags/#ubuntu" title="ubuntu" rel="1">ubuntu</a> &nbsp;
  
    <a href="/tags/#ruby" title="ruby" rel="1">ruby</a> &nbsp;
  
    <a href="/tags/#windows" title="windows" rel="1">windows</a> &nbsp;
  
    <a href="/tags/#ole" title="ole" rel="1">ole</a> &nbsp;
  
    <a href="/tags/#property" title="property" rel="1">property</a> &nbsp;
  
    <a href="/tags/#values" title="values" rel="1">values</a> &nbsp;
  
</div>


<div class="sidebar-module">
  <h4>Archives</h4>

  
  
  
  
  
  <li id="2017" > <a href="/archives/#2017">2017</a></li>
  
  
  
  
  
  
  
  
  
  <li id="2016" > <a href="/archives/#2016">2016</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2014" > <a href="/archives/#2014">2014</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2013" > <a href="/archives/#2013">2013</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2012" > <a href="/archives/#2012">2012</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

</div>


</div>



  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/">An Ostler in IT</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> 
  on 
  
  <a href="https://github.com/">Github</a>
  
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="http://yulijia.net">Lijia Yu</a>
  | Adapted by Ian Rumford  


  <div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
    <a title="Back To Top"><img src="/images/topbutton.png"/></a>
  </div>

  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/totop.js"></script>  



</footer>


</div>

</body>

</html>
